C51 COMPILER V9.01   1                                                                     09/28/2012 16:02:11 PAGE 1   


C51 COMPILER V9.01, COMPILATION OF MODULE 1
OBJECT MODULE PLACED IN 1.OBJ
COMPILER INVOKED BY: d:\Keil\C51\BIN\C51.EXE 1.c BROWSE DEBUG OBJECTEXTEND

line level    source

   1          #include <AT89X52.H>
   2          #include<INTRINS.H>
   3          #define LCD_DATA_PORT  P1   //接液晶数据口
   4          
   5          #define LCD_EN  P1_3   //接液晶使能端
   6          #define LCD_RS  P1_2   //RS=1写数据，RS=0写命令
   7          
   8          
   9          /**********************函数声明***************************/
  10          void LCD_write_char (unsigned char Data,unsigned char command);//写命令或写数据函数
  11          /*******************延时函数*************************/
  12          //系统时钟：12MHZ
  13          void delay_nus(unsigned int n)       //N us延时函数
  14            {
  15   1         unsigned int i=0 ;
  16   1         for (i=0;i<n;i++)
  17   1             _nop_();
  18   1        }
  19            
  20          void delay_nms(unsigned int n)       //N ms延时函数
  21            {
  22   1         unsigned char  i=0;
  23   1         while(n--)
  24   1         {
  25   2         for (i=0;i<120;i++);
  26   2         }
  27   1        }
  28          
  29          /********************液晶初始化函数************************/
  30          void LCD_init(void)       
  31          {
  32   1       delay_nms(5);
  33   1       LCD_write_char(0x28,0);  //4位显示
  34   1       LCD_write_char(0x0c,0);  //显示开
  35   1       LCD_write_char(0x06,0);
  36   1       LCD_write_char(0x01,0);  //清屏
  37   1      }
  38          /********************液晶使能函数************************/
  39          void LCD_en_write(void)  
  40          { LCD_EN=0;
  41   1        delay_nus(2);
  42   1        LCD_EN=1;
  43   1        delay_nus(2);
  44   1        LCD_EN=0;
  45   1      }
  46          
  47          /*********************写命令或写数据函数*******************/
  48          void LCD_write_data(unsigned char Data_command)
  49          { unsigned char temp;
  50   1        temp=Data_command;
  51   1        LCD_DATA_PORT&=0X0f; //LCD_DATA_PORT=LCD_DATA_PORT&0X0f+
  52   1        LCD_DATA_PORT|=temp&0xf0; //写高四位
  53   1        LCD_en_write();
  54   1        temp=temp<<4;
  55   1        LCD_DATA_PORT&=0x0f;
C51 COMPILER V9.01   1                                                                     09/28/2012 16:02:11 PAGE 2   

  56   1        LCD_DATA_PORT|=temp&0xf0;  //写低四位
  57   1        LCD_en_write();
  58   1      }
  59          /*********************写命令和写数据函数*******************/
  60          //参数：command=1,写数据，command=0写命令
  61          void LCD_write_char(unsigned char Data_or_command,unsigned char command) 
  62          {
  63   1       if(command==0)
  64   1       {
  65   2       LCD_RS=0;   //RS=0，选择指令寄存器
  66   2        LCD_write_data(Data_or_command);  
  67   2       }
  68   1       else
  69   1       {
  70   2        LCD_RS=1;  //RS=1，选择数据寄存器
  71   2        LCD_write_data(Data_or_command);
  72   2        }
  73   1      }
  74          /**********************设置显示地址函数********************/
  75            void LCD_set_xy( unsigned char x, unsigned char y )
  76            {
  77   1          unsigned char address;
  78   1          if (y == 0) 
  79   1        address = 0x80 + x;
  80   1          else 
  81   1               address = 0xc0 + x;
  82   1          LCD_write_char( address, 0 );
  83   1        }
  84          /*********************写字符串函数************************/
  85          //参数：X为显示在第几列,Y为显示在第几行,s为待显示字符串
  86          void LCD_write_string(unsigned char X,unsigned char Y,unsigned char *s)
  87            { 
  88   1          LCD_set_xy( X, Y ); //写地址
  89   1      
  90   1      
  91   1          while (*s)  // 写显示字符
  92   1            {
  93   2              LCD_write_char(*s,1);
  94   2        s++;
  95   2            }
  96   1        }
  97          /*******************主函数*************************/
  98          void main(void)
  99          {
 100   1           LCD_RS=1;
 101   1           LCD_EN=1;
 102   1           LCD_init();
 103   1           while(1)    //循环
 104   1             { 
 105   2      
 106   2               LCD_write_char(0x01,0);
 107   2                delay_nms(10);
 108   2               LCD_write_string(0,0,"I love you!");
 109   2               LCD_write_string(0,1,"Do you love me!");
 110   2               delay_nms(10000);  
 111   2                LCD_write_string(0,0,"You(^_^)You!");
 112   2                LCD_write_string(0,1,"2011.3.25Text OK!");
 113   2              delay_nms(10000); 
 114   2             }
 115   1      }
 116          
 117           
C51 COMPILER V9.01   1                                                                     09/28/2012 16:02:11 PAGE 3   

 118          


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =    275    ----
   CONSTANT SIZE    =     59    ----
   XDATA SIZE       =   ----    ----
   PDATA SIZE       =   ----    ----
   DATA SIZE        =   ----       3
   IDATA SIZE       =   ----    ----
   BIT SIZE         =   ----    ----
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
