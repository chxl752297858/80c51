C51 COMPILER V9.00   MAIN                                                                  10/05/2011 00:21:36 PAGE 1   


C51 COMPILER V9.00, COMPILATION OF MODULE MAIN
OBJECT MODULE PLACED IN main.OBJ
COMPILER INVOKED BY: D:\installs soft disk\Keil C51\C51\BIN\C51.EXE main.c BROWSE DEBUG OBJECTEXTEND

line level    source

   1          /****12M晶振下89c52单片机lcd1602+164驱动程序*************/
   2          
   3          
   4          #include <reg52.h>
   5          #define uchar unsigned char
   6          #define uint unsigned int
   7          uchar table[]={"love you my love"};
   8          uint i,shi,fen,miao,aa;
   9          sbit rs=P3^5;  //  
  10          sbit rw=P3^6;  //写数据线
  11          sbit e=P3^7;  //使能线
  12          
  13          sbit dat_164=P3^3;//164数据线
  14          sbit clk_164=P3^4;//164时钟线
  15          
  16          
  17           void sendchar(uchar ch)//向1602送一字节显示数据
  18          {
  19   1      
  20   1      uchar i;
  21   1      for(i=0;i<8;i++)
  22   1      {
  23   2      clk_164=0;
  24   2      dat_164=ch&0x01;
  25   2      clk_164=1;
  26   2      ch>>=1;
  27   2      }
  28   1      }
  29          
  30          
  31          void delay_50us(uint t)  //延时50US
  32          {uchar j;
  33   1      for(;t>0;t--)
  34   1      for(j=19;j>0;j--);
  35   1      }
  36          
  37          void write_com(uchar com)  //写数据  
  38          {
  39   1      
  40   1      e=0;
  41   1      rs=0;
  42   1      rw=0;
  43   1      sendchar(com); //
  44   1      delay_50us(10);
  45   1      e=1;
  46   1      delay_50us(20);
  47   1      e=0;
  48   1      }
  49          
  50          void write_data(uchar dat) //写指令
  51          {
  52   1      
  53   1      e=0;
  54   1      rs=1;
  55   1      rw=0;
C51 COMPILER V9.00   MAIN                                                                  10/05/2011 00:21:36 PAGE 2   

  56   1      sendchar(dat);
  57   1      e=1;
  58   1      delay_50us(10);
  59   1      e=0;
  60   1      delay_50us(20);
  61   1      }
  62          
  63          
  64          void init_1602(void)  //初始化
  65          {   delay_50us(300); //延时15毫秒
  66   1          write_com(0x38);//不检测忙信号
  67   1          delay_50us(100);//延时5毫秒
  68   1          write_com(0x38);//不检测忙信号
  69   1          delay_50us(100);//延时5毫秒
  70   1              write_com(0x38);//不检测忙信号
  71   1              write_com(0x38);//显示模式设置
  72   1          write_com(0x08);//显示关闭
  73   1          write_com(0x01);//显示清屏
  74   1          write_com(0x06);//显示光标移动设置  
  75   1          write_com(0x0c);//显示开及光标移动设置
  76   1      }
  77          
  78          void init_timer0()           //初始化
  79          { 
  80   1       
  81   1          TMOD=0x01;
  82   1          TH0=(65536-50000)/256;
  83   1          TL0=(65536-50000)%256;
  84   1          EA=1;
  85   1          ET0=1;
  86   1          TR0=1; 
  87   1      }
  88          
  89          void  main()  //主函数
  90          {
  91   1      
  92   1       
  93   1       init_1602();
  94   1       init_timer0();
  95   1       
  96   1       while(1)
  97   1          {
  98   2               write_com(0x80);
  99   2               write_data(0x30+(fen/10));
 100   2               
 101   2               write_com(0x81);
 102   2               write_data(0x30+(fen%10));
 103   2               write_com(0x82);
 104   2               write_data(':');
 105   2               write_com(0x83);
 106   2               write_data(0x30+(miao/10));
 107   2               
 108   2               write_com(0x84);
 109   2               write_data(0x30+(miao%10));
 110   2      
 111   2      
 112   2               }
 113   1      
 114   1      }
 115           
 116          
 117          
C51 COMPILER V9.00   MAIN                                                                  10/05/2011 00:21:36 PAGE 3   

 118             void timer0() interrupt 1 //中断累加
 119          {
 120   1          TH0=(65536-50000)/256;
 121   1          TL0=(65536-50000)%256;
 122   1          aa++; 
 123   1          if(aa==20)    //当aa==20时，为一秒
 124   1             {
 125   2               aa=0;       //aa清零
 126   2               miao++;
 127   2               if(miao==60)//清零之后，miao加一
 128   2               {   
 129   3                  miao=0;
 130   3                  fen++;
 131   3                  if(fen==60)
 132   3                  {
 133   4                   fen=0;
 134   4                  }
 135   3               }
 136   2             }                    
 137   1      
 138   1      
 139   1      
 140   1      }
 141          
 142          
 143          


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =    322    ----
   CONSTANT SIZE    =   ----    ----
   XDATA SIZE       =   ----    ----
   PDATA SIZE       =   ----    ----
   DATA SIZE        =     27    ----
   IDATA SIZE       =   ----    ----
   BIT SIZE         =   ----    ----
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
