C51 COMPILER V9.00   1                                                                     10/22/2011 15:32:58 PAGE 1   


C51 COMPILER V9.00, COMPILATION OF MODULE 1
OBJECT MODULE PLACED IN 1.OBJ
COMPILER INVOKED BY: D:\installs soft disk\Keil C51\C51\BIN\C51.EXE 1.c BROWSE DEBUG OBJECTEXTEND

line level    source

   1          #include<reg52.h>
   2          #include<intrins.h>
   3          #define uchar unsigned char
   4          #define uint unsigned int
   5          sbit sda=P2^0;
   6          sbit scl=P2^1;
   7          
   8          sbit e_clk=P3^7;  //´®ÐÐÊ±ÖÓÐÅºÅ
   9          sbit rw_sid=P3^6; //´®ÐÐÊý¾ÝÏß
  10          
  11          
  12          uchar a,k;
  13          void delay()
  14          {_nop_(); 
  15   1       _nop_(); 
  16   1       _nop_(); 
  17   1      }
  18          void start()  //¿ªÊ¼ÐÅºÅ
  19          {       
  20   1              sda=1;
  21   1              delay();
  22   1              scl=1;
  23   1              delay();
  24   1              sda=0;
  25   1              delay();
  26   1      }
  27          
  28          void stop()   //Í£Ö¹
  29          {
  30   1              sda=0;
  31   1              delay();
  32   1              scl=1;
  33   1              delay();
  34   1              sda=1;
  35   1              delay();
  36   1      }
  37          
  38          void respons()  //Ó¦´ð
  39          {
  40   1              uchar i;
  41   1              scl=1;
  42   1              delay();
  43   1              while((sda==1)&&(i<25))i++;
  44   1              scl=0;
  45   1              delay();
  46   1      }
  47          
  48          void init()
  49          {
  50   1              sda=1;
  51   1              delay();
  52   1              scl=1;
  53   1              delay();
  54   1      }
  55          
C51 COMPILER V9.00   1                                                                     10/22/2011 15:32:58 PAGE 2   

  56          void write_byte(uchar date)
  57          {
  58   1              uchar i,temp;
  59   1              temp=date;
  60   1      
  61   1      
  62   1              for(i=0;i<8;i++)
  63   1              {
  64   2                      temp<<=1;
  65   2                      scl=0;
  66   2                  delay();
  67   2                      sda=CY;
  68   2                      delay();
  69   2                      scl=1;
  70   2                      delay();
  71   2              //      scl=0;
  72   2           //   delay();
  73   2              }
  74   1              scl=0;
  75   1              delay();
  76   1              sda=1;
  77   1              delay();
  78   1      }
  79          
  80          uchar read_byte()
  81          {
  82   1              uchar i,k;
  83   1              scl=0;
  84   1              delay();
  85   1              sda=1;
  86   1              delay();
  87   1              for(i=0;i<8;i++)
  88   1              {
  89   2                      scl=1;
  90   2                      delay();        
  91   2                      k=(k<<1)|sda;
  92   2                      scl=0;
  93   2                      delay();        
  94   2              }
  95   1              return k;
  96   1      }
  97          
  98          void delay1(uint i)
  99          {
 100   1              uchar j;
 101   1              for(;i>0;i--)
 102   1               for(j=6245;j>0;j--);
 103   1      }
 104          
 105          void write_add(uchar address,uchar date)//Ð´Êý¾Ý
 106          {
 107   1              start();  //ÆðÊ¼ÐÅºÅ
 108   1              write_byte(0xa0);
 109   1              respons();//Ó¦´ðÐÅºÅ
 110   1              write_byte(address); //Ð´µØÖ·
 111   1              respons(); //Ó¦´ðÐÅºÅ
 112   1              write_byte(date); //Ð´Êý¾Ý
 113   1              respons();//Ó¦´ðÐÅºÅ
 114   1              stop(); //Í£ÐÅºÅ
 115   1      }
 116          
 117          
C51 COMPILER V9.00   1                                                                     10/22/2011 15:32:58 PAGE 3   

 118          uchar read_add(uchar address) //¶ÁµØÖ·
 119          {
 120   1              uchar date;
 121   1              start();
 122   1              write_byte(0xa0);
 123   1              respons();
 124   1              write_byte(address);
 125   1              respons();
 126   1              start();
 127   1              write_byte(0xa1);
 128   1              respons();
 129   1              date=read_byte();
 130   1              stop();
 131   1              return date;
 132   1      }
 133          
 134          
 135          
 136          /********´®ÐÐ12864ÏÔÊ¾Çý¶¯³ÌÐò***********/
 137          void  delay_50us(uint j)   //ÑÓÊ±50uS  
 138              {   
 139   1              uint  i; 
 140   1              for(; j>0; j--); 
 141   1              for(i=19; i>0; i--);  
 142   1          }
 143          
 144          //´®ÐÐ·¢ËÍÒ»×Ö½ÚÊý¾Ý   
 145          void send_byte(uchar  dat)   
 146              {   
 147   1                       uchar i;   
 148   1                       for(i=0;i<8;i++)   
 149   1                      {   
 150   2                        e_clk=0;   
 151   2                        if(dat&0x80)//¶ÁÈ¡×î¸ßÎ»µÄÖµÈç¹ûÊÇ1Ôòrw_sidÎª1£¬·ñÔòrw_sidÎª0£»
 152   2                        rw_sid=1;
 153   2                        else     
 154   2                        rw_sid=0; 
 155   2                                        e_clk=1;   
 156   2                        dat=dat<<1; //ÓÒÒÆÒ»Î»  
 157   2                       }   
 158   1          } 
 159          
 160          //Ð´¿ØÖÆÃüÁî·ÖÈý¸ö×Ö½ÚÐ´  
 161          void     write_com(uchar  dat)   
 162              {
 163   1                    send_byte(0xF8);//´®¿Ú¿ØÖÆ¸ñÊ½ 1111 1000     RW=0,RS=0  RW=0±íÊ¾Êý¾Ý´ÓMCUÐ´µ½LCD RS=0±íÊ¾Êý¾
             -ÝÊÇ¿ØÖÆÖ¸Áî 
 164   1                    send_byte(dat&0xF0);//²¢ÐÐ8Î»Êý¾Ý¸ß4Î»¸ñÊ½ 1111 0000  µÍËÄÎ»ÖÃ0  RW=1±íÊ¾Êý¾Ý´ÓLCDÐ´µ½MCD RS
             -=1±íÊ¾ÏÔÊ¾Êý¾Ý 
 165   1                    send_byte((dat&0x0F)<<4);//²¢ÐÐ8Î»Êý¾ÝµÍ4Î»¸ñÊ½ ¸ßËÄÎ»ÖÃ0 0000 1111  ×óÒÆ4Î»ºóÎ»1111 0000 
 166   1                                
 167   1          }
 168          
 169          
 170          //Ð´ÏÔÊ¾Êý¾Ý»òµ¥×Ö½Ú×Ö·û   
 171          void     write_data(uchar dat)   
 172              
 173              {         send_byte(0xFA);//1111 1010     RW=0,RS=1   
 174   1                    send_byte(dat&0xF0);//¸ßËÄÎ»   
 175   1                    send_byte((dat&0x0F)<<4);//µÍËÄÎ»  
 176   1          }
 177          
C51 COMPILER V9.00   1                                                                     10/22/2011 15:32:58 PAGE 4   

 178             /*
 179          void display(uchar n,uchar m,uchar *s) //Ð´×Ö·ûÔÚÄÄÐÐÄÇÁÐ
 180          {
 181            
 182              switch(n)
 183           {
 184               case 1:write_com(0x80+m-1);break;
 185               case 2:write_com(0x90+m-1);break;
 186               case 3:write_com(0x88+m-1);break;
 187               case 4:write_com(0x98+m-1);break;
 188            default:;
 189           }
 190          
 191            while(*s>0)
 192           {
 193              write_data(*s);
 194              s++;
 195              delay_50us(1);
 196           }
 197          } 
 198                  */
 199          
 200           //³õÊ¼»¯     LCM   
 201          void     init_12864(void)   
 202              {   
 203   1                   delay_50us(100); //³õÊ¼»¯µÈ´ýÊ±¼ä40ms  
 204   1                   write_com(0x30);//¹¦ÄÜÉèÖÃ£¬Ò»´ÎËÍ8Î»Êý¾Ý£¬»ù±¾Ö¸Áî¼¯   
 205   1                   delay_50us(3);     //µÈ´ýÊÇ¼äÒª´óÓÚ100¸öus
 206   1                               write_com(0x30);//¹¦ÄÜÉèÖÃ£¬Ò»´ÎËÍ8Î»Êý¾Ý£¬»ù±¾Ö¸Áî¼¯ 
 207   1                               delay_50us(2); //µÈ´ýÊÇ¼äÒª´óÓÚ37¸öus 
 208   1                               write_com(0x0C);//0000,1100       ÕûÌåÏÔÊ¾£¬ÓÎ±êoff£¬ÓÎ±êÎ»ÖÃoff 
 209   1                               delay_50us(3); //µÈ´ýÊÇ¼äÒª´óÓÚ37¸öus  
 210   1                   write_com(0x01);//0000,0001     ÇåÆÁ   
 211   1                   delay_50us(200);   //µÈ´ýÊ±¼ä´óÓÚ10ms
 212   1                               write_com(0x06);//0000,0010     DDRAMµØÖ·¹éÎ»   
 213   1                   delay_50us(10);
 214   1          }
 215          
 216          
 217          
 218          void main()
 219          {       init_12864();
 220   1          init();
 221   1         
 222   1         for(k=0;k<=64;k++)
 223   1         {
 224   2              write_add(k,k);
 225   2              delay1(10);
 226   2         
 227   2              }
 228   1         
 229   1              while(1)
 230   1              {
 231   2      
 232   2              write_com(0x80);
 233   2              for(k=0;k<=64;k++)
 234   2              {
 235   3              write_data(read_add(k)+0x30);
 236   3          }
 237   2      
 238   2              }
 239   1      }
C51 COMPILER V9.00   1                                                                     10/22/2011 15:32:58 PAGE 5   

 240          
 241          


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =    433    ----
   CONSTANT SIZE    =   ----    ----
   XDATA SIZE       =   ----    ----
   PDATA SIZE       =   ----    ----
   DATA SIZE        =      2       1
   IDATA SIZE       =   ----    ----
   BIT SIZE         =   ----    ----
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
